# 地址解析问题排查指南

## 问题现象
地图显示所有位置都在中山大学默认位置，说明地址解析失败。

## 已添加的调试功能

### 1. 详细的控制台日志
现在 AmapModal 组件会输出详细的地址解析调试信息：
- 地址数据内容
- AMap.Geocoder 可用性
- 地理编码器初始化状态
- 解析结果详细信息
- 成功/失败的具体原因

### 2. 可视化提示
- 地址解析失败时，信息窗体会显示红色警告提示
- 成功解析时显示具体的经纬度坐标
- 信息窗体包含地址、坐标、匹配度等详细信息

### 3. 调试工具
创建了 `test-address-debug.vue` 文件，可用于：
- 测试特定地址的解析效果
- 模拟订单数据测试
- 独立测试地图弹窗功能

## 排查步骤

### 第一步：检查控制台日志
打开浏览器开发者工具（F12），查看 Console 面板：

1. 点击"查看商家位置"或"查看用户位置"按钮
2. 查找以下日志：
   ```
   === 地址解析调试信息 ===
   解析地址数据: { title, address, type, addressLength }
   开始地址解析: [地址文本]
   地理编码结果: { status, result, hasGeocodes }
   ```

3. 根据日志结果判断：
   - ✅ **解析成功**：会显示经纬度坐标
   - ❌ **解析失败**：会显示失败原因

### 第二步：检查地址数据质量
常见问题：

1. **地址为空**：
   - 日志显示 `addressLength: 0`
   - 检查后端数据库中的 `pickupAddress` 和 `deliveryAddress` 字段

2. **地址不完整**：
   - 地址过于简单，如"食堂"
   - 需要包含省市区信息，如"广东省珠海市香洲区中山大学珠海校区荔园"

3. **地址格式问题**：
   - 包含特殊字符或乱码
   - 地址过长或过短

### 第三步：测试地址解析服务
使用调试工具测试：

1. 在浏览器中访问测试页面（需要添加到路由）
2. 输入测试地址，如：
   - "中山大学珠海校区榕园4号"
   - "广东省珠海市香洲区中山大学珠海校区荔园"
   - "珠海市香洲区唐家湾中山大学"

3. 点击"测试地址解析"按钮
4. 查看解析结果

### 第四步：检查高德地图配置
确保 `.env.development` 文件中的配置正确：

```env
VITE_AMAP_KEY=e3064e9e20ff62d8ebb59d24d634c179
VITE_AMAP_SECURITY_CODE=4bf89c4e16d60340e676f6cc39beff32
```

### 第五步：检查网络权限
- 确保能访问 `restapi.amap.com`（后端）
- 确保能访问 `webapi.amap.com`（前端）
- 检查是否有防火墙或代理拦截

## 常见解决方案

### 1. 后端地址数据问题
如果地址数据为空或不完整，需要：
- 检查订单创建时的地址录入
- 确认商家地址 (`shop_location`) 字段有值
- 确认用户收货地址拼接正确

### 2. 地理编码器配置优化
已在代码中添加以下优化：
- 设置城市为"珠海"
- 增加搜索半径为1000米
- 添加基础扩展信息

### 3. 错误处理改进
- 地址为空时直接显示默认位置
- 解析失败时显示明确的错误提示
- 提供调试信息便于问题定位

## 测试用例

### 推荐测试地址（珠海地区）
```
1. 中山大学珠海校区榕园4号
2. 广东省珠海市香洲区中山大学珠海校区荔园
3. 珠海市香洲区唐家湾中山大学珠海校区
4. 珠海市香洲区情侣北路中山大学
5. 中山大学珠海校区榕园4号（学生宿舍）
```

### 应该避免的测试地址
```
❌ 食堂（过于简单）
❌ 1栋（缺少上下文）
❌ 空字符串
❌ 特殊字符过多
```

## 后续优化建议

1. **地址标准化**：在订单录入时对地址进行标准化处理
2. **缓存机制**：对解析成功的地址进行缓存，提高响应速度
3. **备用方案**：集成多个地图服务（如百度地图）作为备选
4. **地址验证**：在订单创建时验证地址的可解析性

## 联系支持

如果问题仍然存在，请提供：
1. 控制台日志截图
2. 测试地址和对应的解析结果
3. 网络环境信息（是否有代理、VPN等）
4. 具体的错误提示信息